---
Title: CentOS6.5にvagrantをいれた
Date: 2015-07-14T20:33:28+09:00
URL: https://sisisin.hateblo.jp/entry/2015/07/14/203328
EditURL: https://blog.hatena.ne.jp/sisisin444/sisisin.hateblo.jp/atom/entry/8454420450101506539
---



#なぜか
+ 物理マシンに全部入れるの、めんどくさい（環境の違いとか
+ 同じマシンでアプリケーションとかDBとか全部動かすの嫌だった
+ ﾋｬｯﾊｧｰ!!汚物は消毒だァー!!が出来るのは素晴らしい
+ Dockerでいいじゃん説はすごいあるけど、とり急ぎアプリ動かせる環境が欲しかったので避けた

#まずVirtualBoxいれます
dkmsというのを入れておくといいらしいので先に入れる。
yumリポジトリの指定は32bitの方を。マシンが32bitなので
```bash
$ sudo rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm
$ sudo yum info dkms
$ sudo yum install -y dkms

```


次にVBox

```bash
$ cd /etc/yum.repos.d/
$ sudo wget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repo
$ sudo yum install -y VirtualBox-4.3
$ sudo usermod -a -G vboxusers app
```


そしてvagrant

```bash
$ sudo yum  -y install rubygems
$ wget http://files.vagrantup.com/packages/7ec0ee1d00a916f80b109a298bab08e391945243/vagrant_1.2.7_i686.rpm
$ sudo rpm -ivh vagrant_1.2.7_i686.rpm

```

これだけだとバグがあって動かないみたいなのでコードを直接修正しなきゃいけないとか。怖い。

```bash
cd /opt/vagrant/embedded/gems/gems/vagrant-1.2.7/plugins/hosts/fedora/
vim host.rb
diff host.rb host.rb.org
39,40c39
<             #version_number = /Fedora.*release ([0-9]+)/.match(f.gets)[1].to_i
<             version_number = /[Fedora|CentOS].*release ([0-9]+)/.match(f.gets)[1].to_i
---
>             version_number = /Fedora.*release ([0-9]+)/.match(f.gets)[1].to_i
-[3298]% cat /etc/redhat-release
```

このあと`vagrant init`して無事Vagrantfileが生成された。
が、vagrant upしようとするとvirtualboxが立ち上がらない。dkmsがどうのって文句言われている。
とりあえずvirtual boxとかdkmsを`yum remove`してやって最初からやり直し。
ググったらdkmsの対処まで含めて手順を後悔してる記事があったので、それの通りにvirtual boxをセットアップする

[VirtualBox導入手順(CentOS 6.4)](http://l-w-i.net/t/virtualbox/0install_001.txt)

ここの`sudo /etc/rc.d/init.d/vboxdrv setup`までやって、すべてOKだったので`vagrant up`
無事マシンが起動された。

# 所感
楽だと思ってたのにすごいめんどうくさかったです。



# 参考リンク
[vagrantをCentOS6.4にインストール 32bit と 64bit](http://kotatudou-tech.hatenablog.jp/entry/2013/08/04/222106)
[CentOS 上で Vagrant を導入するまでのメモ（CUI）](http://qiita.com/Itomaki/items/9a6a314a853cdcd00f80)
[VirtualBox導入手順(CentOS 6.4)](http://l-w-i.net/t/virtualbox/0install_001.txt)
[DKMSのビルドで「Your kernel headers for kernel 2.6.32-358.xxx cannot be found at /lib/modules/2.6.32-xxx/build or /lib/modules/2.6.32-358.xxx/source」というエラーが出る](http://l-w-i.net/t/centos/dkms_100.txt)
